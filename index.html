<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />

  <!-- iOS 全屏与图标 -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Wallet" />
  <meta name="format-detection" content="telephone=no" />

  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icon-192.png" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <title>Wallet</title>

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --line:rgba(15,23,42,.08);
      --text:#0f172a;
      --mut:rgba(15,23,42,.55);
      --blue:#2f6bff;
      --blue2:#1f8bff;
      --green:#22c55e;
      --red:#ef4444;
      --shadow:0 10px 28px rgba(15,23,42,.08);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;background:var(--bg);color:var(--text);}
    .app{max-width:520px;margin:0 auto;}
    .safe{padding:calc(10px + env(safe-area-inset-top)) 16px calc(86px + env(safe-area-inset-bottom));}

    /* 顶部栏 */
    .top{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 2px;}
    .acct{display:flex;align-items:center;gap:10px;}
    .avatar{width:34px;height:34px;border-radius:999px;background:#eaf0ff;display:grid;place-items:center;font-weight:900;color:#2857d8;}
    .acctName{font-weight:900;}
    .pill{font-size:12px;color:var(--mut);}

    /* 大蓝卡 */
    .hero{
      border-radius:22px;
      background:linear-gradient(135deg,var(--blue),var(--blue2));
      color:#fff;
      padding:18px;
      box-shadow:0 14px 40px rgba(47,107,255,.25);
      position:relative;
      overflow:hidden;
    }
    .hero::after{
      content:"";
      position:absolute;right:-60px;top:-60px;width:180px;height:180px;border-radius:999px;
      background:rgba(255,255,255,.18);
    }
    .heroMoney{font-size:34px;font-weight:950;letter-spacing:.2px;margin:4px 0 10px;}
    .heroRow{display:flex;justify-content:space-between;align-items:center;gap:10px;}
    .addr{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;font-size:12px;opacity:.92;max-width:72%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .copyBtn{
      border:0;background:rgba(255,255,255,.18);color:#fff;
      padding:8px 10px;border-radius:12px;font-weight:900;
    }

    /* 快捷功能条 */
    .quick{
      margin-top:12px;
      background:var(--card);
      border:1px solid var(--line);
      border-radius:18px;
      padding:12px;
      display:flex;
      justify-content:space-between;
      gap:6px;
      box-shadow:var(--shadow);
    }
    .qbtn{
      flex:1;
      display:flex;flex-direction:column;align-items:center;gap:6px;
      padding:10px 6px;border-radius:14px;
      border:1px solid transparent;
      color:var(--text);
    }
    .qicon{
      width:42px;height:42px;border-radius:16px;
      background:#eef4ff;
      display:grid;place-items:center;
      font-weight:950;color:#2f6bff;
    }
    .qtext{font-size:12px;color:rgba(15,23,42,.78);font-weight:800;}

    /* 卡片/列表 */
    .card{margin-top:12px;background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:var(--shadow);}
    .cardHead{display:flex;justify-content:space-between;align-items:center;padding:14px 14px 10px;}
    .cardTitle{font-weight:950;}
    .cardAction{font-size:12px;color:#2f6bff;font-weight:900;}

    .row{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;border-top:1px solid var(--line);}
    .left{display:flex;align-items:center;gap:12px;min-width:0;}
    .coin{
      width:44px;height:44px;border-radius:18px;background:#f1f5ff;
      display:grid;place-items:center;font-weight:950;color:#2f6bff;
    }
    .name{font-weight:950;}
    .sub{font-size:12px;color:var(--mut);margin-top:2px;}
    .right{text-align:right;}
    .amt{font-weight:950;}
    .usd{font-size:12px;color:var(--mut);margin-top:2px;}

    /* 页面标题栏（返回 + 标题） */
    .nav{
      display:flex;align-items:center;gap:10px;
      padding:8px 2px;
    }
    .back{
      width:34px;height:34px;border-radius:12px;background:var(--card);
      border:1px solid var(--line);
      display:grid;place-items:center;font-weight:950;
    }
    .navTitle{flex:1;text-align:center;font-weight:950;}
    .navRight{width:34px;height:34px;}

    /* 表单块（和截图类似的大圆角输入） */
    .fieldBlock{
      margin-top:12px;background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:var(--shadow);
      overflow:hidden;
    }
    .fieldLabel{padding:14px 14px 8px;color:rgba(15,23,42,.70);font-weight:900;}
    .inputWrap{padding:0 14px 14px;}
    input,select{
      width:100%;padding:14px 14px;border-radius:16px;border:1px solid var(--line);
      background:#f7f9ff;color:var(--text);outline:none;
      font-size:14px;
    }
    .hintRow{display:flex;justify-content:space-between;margin-top:10px;font-size:12px;color:var(--mut);}

    /* 底部大按钮 */
    .bottomCTA{
      position:fixed;left:0;right:0;bottom:0;
      padding:12px 16px calc(12px + env(safe-area-inset-bottom));
      background:rgba(245,247,251,.92);
      border-top:1px solid rgba(15,23,42,.08);
      backdrop-filter:blur(12px);
    }
    .cta{
      max-width:520px;margin:0 auto;
      background:#cfe0ff;border:0;color:#3a5db6;
      width:100%;padding:14px 14px;border-radius:16px;
      font-weight:950;font-size:16px;
    }
    .cta.primary{background:var(--blue);color:#fff;}
    .cta:disabled{opacity:.55}

    /* 底部导航（截图那种轻量 icon+字） */
    .tabbar{
      position:fixed;left:0;right:0;bottom:0;
      padding:10px 14px calc(10px + env(safe-area-inset-bottom));
      background:rgba(245,247,251,.92);
      border-top:1px solid rgba(15,23,42,.08);
      backdrop-filter: blur(12px);
    }
    .tabs{max-width:520px;margin:0 auto;display:flex;gap:10px;}
    .tab{
      flex:1;padding:10px 10px;border-radius:16px;
      border:1px solid transparent;
      background:transparent;
      color:rgba(15,23,42,.55);
      font-weight:900;
      display:flex;flex-direction:column;align-items:center;gap:4px;
      font-size:12px;
    }
    .tab .dot{width:22px;height:22px;border-radius:8px;background:#e9efff;display:grid;place-items:center;color:#2f6bff;font-weight:950;}
    .tab.active{color:#2f6bff;}
    .tab.active .dot{background:#dbe7ff;}

    /* 弹窗（首次提示/确认/结果） */
    .mask{position:fixed;inset:0;background:rgba(15,23,42,.35);display:none;align-items:flex-end;padding:16px;}
    .modal{width:100%;max-width:520px;margin:0 auto;background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:var(--shadow);padding:14px;}
    .modal h2{margin:8px 0 6px;font-size:16px;}
    .modal .mut{color:var(--mut);font-size:12px;line-height:1.5;}
    .modalBtns{display:flex;gap:10px;margin-top:12px;}
    .btn{flex:1;padding:12px 12px;border-radius:14px;border:1px solid var(--line);background:#f7f9ff;font-weight:950;}
    .btn.primary{background:var(--blue);border-color:transparent;color:#fff;}

    /* 成功页 */
    .okCircle{
      width:54px;height:54px;border-radius:999px;background:rgba(34,197,94,.12);
      display:grid;place-items:center;color:var(--green);font-weight:950;font-size:24px;
      margin:14px auto 8px;
    }
    .center{text-align:center;}
    .bigOk{font-weight:950;color:var(--green);margin-top:6px;}
    .smallTime{font-size:12px;color:var(--mut);margin-top:6px;}
    .kv{display:flex;justify-content:space-between;gap:10px;padding:10px 14px;border-top:1px solid var(--line);font-size:12px;}
    .kv .k{color:var(--mut);}
    .kv .v{font-weight:900;max-width:65%;text-align:right;word-break:break-all;}
  </style>
</head>

<body>
<div class="app">
  <div class="safe">

    <!-- ========== 页面：钱包首页 ========== -->
    <div id="pageHome">
      <div class="top">
        <div class="acct">
          <div class="avatar">W</div>
          <div>
            <div class="acctName" id="acctName">Account 01</div>
            <div class="pill" id="networkName">Tron</div>
          </div>
        </div>
        <div class="pill" id="time"></div>
      </div>

      <div class="hero">
        <div style="opacity:.92;font-weight:900;">总资产</div>
        <div class="heroMoney" id="homeUSD">$7.05</div>
        <div class="heroRow">
          <div class="addr" id="homeAddr">TSm6mDgZMK...eBmsiKU</div>
          <button class="copyBtn" id="copyAddr">复制</button>
        </div>
      </div>

      <div class="quick">
        <div class="qbtn" id="goSendFromHome">
          <div class="qicon">↑</div><div class="qtext">转账</div>
        </div>
        <div class="qbtn" id="goReceive">
          <div class="qicon">⌁</div><div class="qtext">收款</div>
        </div>
        <div class="qbtn" id="goHistory">
          <div class="qicon">⟲</div><div class="qtext">记录</div>
        </div>
        <div class="qbtn" id="goEnergy">
          <div class="qicon">⚡</div><div class="qtext">能量</div>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div class="cardTitle">代币</div>
          <div class="cardAction" id="addToken">＋</div>
        </div>

        <div class="row" id="openTRX">
          <div class="left">
            <div class="coin">T</div>
            <div style="min-width:0">
              <div class="name">TRX</div>
              <div class="sub">TRON</div>
            </div>
          </div>
          <div class="right">
            <div class="amt" id="trxBal">23.6224</div>
            <div class="usd" id="trxUsd">$6.88</div>
          </div>
        </div>

        <div class="row" id="openUSDT">
          <div class="left">
            <div class="coin">U</div>
            <div style="min-width:0">
              <div class="name">USDT</div>
              <div class="sub">Tether USD</div>
            </div>
          </div>
          <div class="right">
            <div class="amt" id="usdtBal">0.1712</div>
            <div class="usd" id="usdtUsd">$0.17</div>
          </div>
        </div>
      </div>

      <div style="height:14px;"></div>
    </div>

    <!-- ========== 页面：Token 详情（USDT/TRX 共用） ========== -->
    <div id="pageToken" style="display:none;">
      <div class="nav">
        <div class="back" id="backFromToken">‹</div>
        <div class="navTitle" id="tokenTitle">USDT</div>
        <div class="navRight"></div>
      </div>

      <div class="card" style="padding:16px;">
        <div class="muted">我的余额</div>
        <div style="font-size:28px;font-weight:950;margin-top:8px;" id="tokenBalLine">0.1712 USDT</div>
        <div class="muted" style="margin-top:4px;" id="tokenUsdLine">$0.17</div>

        <div style="display:flex;gap:10px;margin-top:14px;">
          <button class="btn" id="btnTokenReceive">收款</button>
          <button class="btn primary" id="btnTokenSend">转账</button>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div class="cardTitle">历史记录</div>
          <div class="cardAction" id="viewAll">查看全部</div>
        </div>

        <div class="row">
          <div class="left">
            <div class="coin" style="background:#e9f7ff;color:#0284c7;">↑</div>
            <div>
              <div class="name">发送</div>
              <div class="sub">至 TFeYVnuKJq...V3JSuRHd</div>
            </div>
          </div>
          <div class="right">
            <div class="amt" style="color:var(--red);" id="tx1Amt">-200</div>
            <div class="usd" id="tx1Time">12-28 00:39</div>
          </div>
        </div>

        <div class="row" id="openTxDetail">
          <div class="left">
            <div class="coin" style="background:#eafff3;color:#16a34a;">↓</div>
            <div>
              <div class="name">接收</div>
              <div class="sub">来自 TWYrK1xjDd...hnyvFccc</div>
            </div>
          </div>
          <div class="right">
            <div class="amt" style="color:var(--green);" id="tx2Amt">+200</div>
            <div class="usd" id="tx2Time">12-27 12:41</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== 页面：转账（按你截图那种三块结构） ========== -->
    <div id="pageSend" style="display:none;">
      <div class="nav">
        <div class="back" id="backFromSend">‹</div>
        <div class="navTitle" id="sendTitle">USDT 转账</div>
        <div class="navRight"></div>
      </div>

      <div class="center" style="margin-top:2px;">
        <div class="muted" id="sendNet">Tron</div>
      </div>

      <div class="fieldBlock">
        <div class="fieldLabel">收款地址</div>
        <div class="inputWrap">
          <input id="toAddr" placeholder="Tron 地址" />
        </div>
      </div>

      <div class="fieldBlock">
        <div class="fieldLabel">数量</div>
        <div class="inputWrap">
          <input id="amount" type="number" step="0.00000001" placeholder="0" />
          <div class="hintRow">
            <div> </div>
            <div id="availLine">0.1712 USDT</div>
          </div>
        </div>
      </div>

      <div class="fieldBlock">
        <div class="fieldLabel">矿工费</div>
        <div class="inputWrap">
          <select id="feeLevel">
            <option value="0"> $0  ·  0 TRX </option>
            <option value="1"> $0.2 ·  1 TRX </option>
            <option value="2"> $0.6 ·  3 TRX </option>
          </select>
          <div class="hintRow">
            <div id="feeUSD">$0</div>
            <div id="feeCoin">0 TRX</div>
          </div>
        </div>
      </div>

      <div style="height:90px;"></div>
    </div>

    <!-- ========== 页面：确认页（下一步） ========== -->
    <div id="pageConfirm" style="display:none;">
      <div class="nav">
        <div class="back" id="backFromConfirm">‹</div>
        <div class="navTitle">确认转账</div>
        <div class="navRight"></div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div class="cardTitle">概览</div>
          <div class="cardAction"></div>
        </div>
        <div class="kv"><div class="k">发送</div><div class="v" id="cFrom">Account 01</div></div>
        <div class="kv"><div class="k">到</div><div class="v" id="cTo">—</div></div>
        <div class="kv"><div class="k">数量</div><div class="v" id="cAmt">—</div></div>
        <div class="kv"><div class="k">矿工费</div><div class="v" id="cFee">—</div></div>
      </div>

      <div style="height:90px;"></div>
    </div>

    <!-- ========== 页面：交易详情（成功/失败） ========== -->
    <div id="pageResult" style="display:none;">
      <div class="nav">
        <div class="back" id="backFromResult">‹</div>
        <div class="navTitle">交易详情</div>
        <div class="navRight"></div>
      </div>

      <div class="card" style="padding:14px 14px 10px;">
        <div class="okCircle" id="resIcon">✓</div>
        <div class="center">
          <div class="bigOk" id="resTitle">成功</div>
          <div class="smallTime" id="resTime">2025年12月28日 凌晨12点39分</div>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div class="cardTitle">概览</div>
          <div class="cardAction"></div>
        </div>
        <div class="kv"><div class="k">发送</div><div class="v" id="rFrom">Account 01</div></div>
        <div class="kv"><div class="k">到</div><div class="v" id="rTo">—</div></div>
        <div class="kv"><div class="k">金额</div><div class="v" id="rAmt">—</div></div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div class="cardTitle">交易详情</div>
          <div class="cardAction"></div>
        </div>
        <div class="kv"><div class="k">网络</div><div class="v" id="rNet">Tron</div></div>
        <div class="kv"><div class="k">手续费</div><div class="v" id="rFee">0 TRX</div></div>
        <div class="kv"><div class="k">TxID</div><div class="v" id="rTxid">—</div></div>
      </div>
    </div>

  </div>
</div>

<!-- 首次提示（只弹一次，页面其它地方不再写“演示/模拟”） -->
<div class="mask" id="noticeMask">
  <div class="modal">
    <div style="font-weight:950;">提示</div>
    <h2>这是模拟钱包</h2>
    <div class="mut">
      这里显示的余额、手续费、转账结果都是本地生成的效果，不连接真实区块链，也不会产生真实交易。
    </div>
    <div class="modalBtns">
      <button class="btn primary" id="noticeOk">我知道了</button>
    </div>
  </div>
</div>

<!-- 底部：Home 页面用 Tabbar；Send/Confirm/Result 用 CTA -->
<div class="tabbar" id="tabbar">
  <div class="tabs">
    <div class="tab active" id="tabWallet"><div class="dot">⌂</div>钱包</div>
    <div class="tab" id="tabMarket"><div class="dot">↗</div>市场</div>
    <div class="tab" id="tabBrowser"><div class="dot">◎</div>浏览</div>
    <div class="tab" id="tabMe"><div class="dot">☺</div>我</div>
  </div>
</div>

<div class="bottomCTA" id="ctaBar" style="display:none;">
  <button class="cta" id="ctaBtn" disabled>下一步</button>
</div>

<script>
  const $ = (id)=>document.getElementById(id);
  const NOTICE_KEY = "wallet_notice_once_v1";
  const STORE_KEY  = "wallet_state_v1";

  function nowText(){
    const d = new Date();
    $("time").textContent = d.toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
  }
  nowText(); setInterval(nowText, 1000);

  function randomTxid(){
    const bytes = crypto.getRandomValues(new Uint8Array(16));
    return Array.from(bytes).map(b=>b.toString(16).padStart(2,'0')).join('');
  }

  // 本地状态（你可以在设置里改，这里先写死成截图数值）
  const defaultState = {
    accountName: "Account 01",
    network: "Tron",
    address: "TSm6mDgZMKJQWd2QbK5MtFVByj1eBmsiKU",
    assets: {
      TRX:  { bal: 23.6224, usd: 6.88 },
      USDT: { bal: 0.1712,  usd: 0.17 }
    }
  };
  function loadState(){
    const raw = localStorage.getItem(STORE_KEY);
    if(!raw) return structuredClone(defaultState);
    try{
      const s = JSON.parse(raw);
      return { ...structuredClone(defaultState), ...s };
    }catch{
      return structuredClone(defaultState);
    }
  }
  function saveState(s){ localStorage.setItem(STORE_KEY, JSON.stringify(s)); }

  // 页面切换
  const pages = ["pageHome","pageToken","pageSend","pageConfirm","pageResult"];
  function showPage(id){
    for(const p of pages) $(p).style.display = (p===id) ? "" : "none";

    const inFlow = (id==="pageSend" || id==="pageConfirm");
    $("tabbar").style.display = (id==="pageHome" || id==="pageToken") ? "" : "none";
    $("ctaBar").style.display = inFlow ? "" : "none";

    if(id==="pageSend"){
      $("ctaBtn").textContent = "下一步";
      updateSendCTA();
    }
    if(id==="pageConfirm"){
      $("ctaBtn").textContent = "确认";
      $("ctaBtn").disabled = false;
      $("ctaBtn").classList.add("primary");
    }
  }

  // 渲染首页数据
  function renderHome(){
    const s = loadState();
    $("acctName").textContent = s.accountName;
    $("networkName").textContent = s.network;
    $("homeAddr").textContent = s.address.slice(0,10) + "..." + s.address.slice(-8);

    const total = (s.assets.TRX.usd || 0) + (s.assets.USDT.usd || 0);
    $("homeUSD").textContent = "$ " + total.toFixed(2);

    $("trxBal").textContent = s.assets.TRX.bal.toFixed(4);
    $("trxUsd").textContent = "$" + s.assets.TRX.usd.toFixed(2);

    $("usdtBal").textContent = s.assets.USDT.bal.toFixed(4);
    $("usdtUsd").textContent = "$" + s.assets.USDT.usd.toFixed(2);
  }

  // Token 详情
  let currentToken = "USDT";
  function openToken(sym){
    currentToken = sym;
    const s = loadState();
    $("tokenTitle").textContent = sym;
    $("tokenBalLine").textContent = (s.assets[sym].bal.toFixed(4)) + " " + sym;
    $("tokenUsdLine").textContent = "$" + (s.assets[sym].usd.toFixed(2));
    showPage("pageToken");
  }

  // 转账页（对齐截图：USDT + Tron）
  let sendDraft = { sym:"USDT", to:"", amount:0, feeTRX:0, feeUSD:0 };
  function openSend(sym){
    const s = loadState();
    sendDraft.sym = sym;
    $("sendTitle").textContent = sym + " 转账";
    $("sendNet").textContent = s.network;
    $("toAddr").value = "";
    $("amount").value = "";
    $("availLine").textContent = s.assets[sym].bal.toFixed(4) + " " + sym;

    $("feeLevel").value = "0";
    onFeeChange();
    showPage("pageSend");
  }

  function onFeeChange(){
    const v = $("feeLevel").value;
    // 简单模拟：0/1/3 TRX
    const map = {
      "0": {usd:0,  trx:0},
      "1": {usd:0.2,trx:1},
      "2": {usd:0.6,trx:3}
    };
    const m = map[v] || map["0"];
    sendDraft.feeUSD = m.usd;
    sendDraft.feeTRX = m.trx;
    $("feeUSD").textContent = "$" + m.usd;
    $("feeCoin").textContent = m.trx + " TRX";
    updateSendCTA();
  }

  function updateSendCTA(){
    const to = $("toAddr").value.trim();
    const amt = Number($("amount").value || 0);
    const ok = (to.length >= 10) && (amt > 0);
    $("ctaBtn").disabled = !ok;
    $("ctaBtn").classList.toggle("primary", ok);
  }

  // 确认页
  function openConfirm(){
    const s = loadState();
    sendDraft.to = $("toAddr").value.trim();
    sendDraft.amount = Number($("amount").value || 0);

    $("cFrom").textContent = s.accountName;
    $("cTo").textContent = sendDraft.to;
    $("cAmt").textContent = sendDraft.amount.toFixed(4) + " " + sendDraft.sym;
    $("cFee").textContent = sendDraft.feeTRX + " TRX";

    showPage("pageConfirm");
  }

  // 结果页（成功/失败）
  function openResult(ok){
    const s = loadState();
    const d = new Date();
    const timeStr = `${d.getFullYear()}年${d.getMonth()+1}月${d.getDate()}日 ${d.getHours()}点${String(d.getMinutes()).padStart(2,"0")}分`;
    $("resTime").textContent = timeStr;

    if(ok){
      $("resIcon").style.background = "rgba(34,197,94,.12)";
      $("resIcon").style.color = "var(--green)";
      $("resIcon").textContent = "✓";
      $("resTitle").style.color = "var(--green)";
      $("resTitle").textContent = "成功";
    }else{
      $("resIcon").style.background = "rgba(239,68,68,.10)";
      $("resIcon").style.color = "var(--red)";
      $("resIcon").textContent = "!";
      $("resTitle").style.color = "var(--red)";
      $("resTitle").textContent = "失败";
    }

    $("rFrom").textContent = s.accountName;
    $("rTo").textContent = sendDraft.to;
    $("rAmt").textContent = "发送 " + sendDraft.amount.toFixed(4) + " " + sendDraft.sym;
    $("rNet").textContent = s.network;
    $("rFee").textContent = sendDraft.feeTRX + " TRX";
    $("rTxid").textContent = randomTxid();

    showPage("pageResult");
  }

  // 点击绑定
  $("openTRX").onclick = ()=>openToken("TRX");
  $("openUSDT").onclick = ()=>openToken("USDT");
  $("backFromToken").onclick = ()=>showPage("pageHome");
  $("btnTokenSend").onclick = ()=>openSend(currentToken);
  $("btnTokenReceive").onclick = ()=>alert("收款页面你如果也要做，我可以再给你加（同风格）。");
  $("goSendFromHome").onclick = ()=>openSend("USDT");

  $("backFromSend").onclick = ()=>showPage("pageHome");
  $("feeLevel").onchange = onFeeChange;
  $("toAddr").oninput = updateSendCTA;
  $("amount").oninput = updateSendCTA;

  $("backFromConfirm").onclick = ()=>showPage("pageSend");
  $("ctaBtn").onclick = ()=>{
    const current = pages.find(p => $(p).style.display !== "none");
    if(current==="pageSend") openConfirm();
    else if(current==="pageConfirm"){
      // 模拟成功率
      const ok = Math.random() < 0.85;
      if(ok){
        // 扣余额（本地）
        const st = loadState();
        const bal = st.assets[sendDraft.sym].bal;
        st.assets[sendDraft.sym].bal = Math.max(0, bal - sendDraft.amount);
        // 这里不严格换算 usd，你需要的话我再把换算做得更像
        st.assets[sendDraft.sym].usd = st.assets[sendDraft.sym].bal * (sendDraft.sym==="USDT"?1:0.29);
        saveState(st);
        renderHome();
      }
      openResult(ok);
    }
  };

  $("backFromResult").onclick = ()=>showPage("pageHome");
  $("openTxDetail").onclick = ()=>openResult(true);

  $("copyAddr").onclick = async ()=>{
    try{
      const s = loadState();
      await navigator.clipboard.writeText(s.address);
      $("copyAddr").textContent = "已复制";
      setTimeout(()=>$("copyAddr").textContent="复制", 900);
    }catch{
      alert("复制失败");
    }
  };

  // Tabbar（这几个先占位，你要我按截图继续做“市场/浏览/我”的页面也可以）
  $("tabWallet").onclick = ()=>{ setTabActive("tabWallet"); showPage("pageHome"); };
  $("tabMarket").onclick  = ()=>{ setTabActive("tabMarket"); alert("市场页我可以按同风格继续做"); };
  $("tabBrowser").onclick = ()=>{ setTabActive("tabBrowser"); alert("浏览页我可以按同风格继续做"); };
  $("tabMe").onclick      = ()=>{ setTabActive("tabMe"); alert("我的页我可以按同风格继续做"); };
  function setTabActive(id){
    ["tabWallet","tabMarket","tabBrowser","tabMe"].forEach(t=>{
      $(t).classList.toggle("active", t===id);
    });
  }

  // 首次提示（只弹一次）
  (function firstNotice(){
    if(localStorage.getItem(NOTICE_KEY)==="1") return;
    $("noticeMask").style.display = "flex";
    $("noticeOk").onclick = ()=>{
      localStorage.setItem(NOTICE_KEY, "1");
      $("noticeMask").style.display = "none";
    };
  })();

  // SW（离线）
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js").catch(()=>{});
  }

  // 初始化
  renderHome();
  showPage("pageHome");
</script>
</body>
</html>
